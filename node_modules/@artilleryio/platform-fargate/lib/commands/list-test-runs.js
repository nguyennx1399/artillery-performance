/** @license
 * (c) 2021 Shoreditch Ops Ltd. All rights reserved.
 *
 * This file is part of Artillery Pro (https://artillery.io)
 *
 * NOTICE: All information contained herein is, and remains
 * the property of Shoreditch Ops Ltd. The intellectual and
 * technical concepts contained herein are proprietary to
 * Shoreditch Ops Ltd and are protected by copyright law.
 *
 * Modification and/or redistribution of this material is
 * strictly forbidden unless prior written permission is
 * obtained from Shoreditch Ops Ltd.
 *
 */

module.exports = { listTestRuns: listTestRunsCommand };

const debug = require('debug')('commands:list-test-runs');

const { listTestRuns } = require('../data-api/list-test-runs');
const { parseTags } = require('../tags');

const setDefaultAWSCredentials = require('../utils/aws-set-default-credentials');
const normalizeCLIFlags = require('../utils/normalize-cli-flags');

async function listTestRunsCommand(options) {
  normalizeCLIFlags(['max-items'], options);

  const tags = parseTags(options.tags);
  debug({tags});

  try {
    await setDefaultAWSCredentials();

    const results = await listTestRuns(tags, options.maxItems, options.offset);
    console.log(JSON.stringify(results, null, 4));
  }
  catch (err) {
    console.error('Something went wrong');
    console.error(err);
    process.exit(1);
  }
}
